<div class="app-shell">
  <!-- Header Premium -->
  <header class="app-header">
    <div class="app-title">
      <h1>
        <span class="logo-orb"></span>
        Studena · Matching
      </h1>
      
      <div class="header-subtitle" *ngIf="currentStudent">
        <span class="context-pill">
          <svg width="12" height="12" viewBox="0 0 12 12" fill="none">
            <path d="M6 11C8.76142 11 11 8.76142 11 6C11 3.23858 8.76142 1 6 1C3.23858 1 1 3.23858 1 6C1 8.76142 3.23858 11 6 11Z" stroke="currentColor" stroke-width="1.5"/>
            <path d="M6 3V6L8 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {{ currentStudent.full_name }} ({{ currentStudent.level }})
        </span>
      </div>

      <div class="header-subtitle skeleton-text" *ngIf="!currentStudent && !error">
        Chargement du profil...
      </div>
    </div>

    <div class="app-badge">
      <span class="badge-dot"></span>
      Prototype IA
    </div>
  </header>

  <main class="main-card">
    
    <!-- Loading Skeleton Grid -->
    <div *ngIf="loading" class="skeleton-grid">
      <div class="skeleton-card hero"></div> <!-- Hero skeleton -->
      <div class="skeleton-card" *ngFor="let i of [1,2,3]"></div>
    </div>

    <!-- Error State -->
    <div *ngIf="error" class="error-state">
      <div class="error-icon">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
          <circle cx="10" cy="10" r="8" stroke="currentColor" stroke-width="1.5"/>
          <path d="M10 6v4M10 13v.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="error-content">
        <strong>Erreur de calcul</strong>
        <span>{{ error }}</span>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !matches.length && !error" class="empty-state">
      <div class="empty-illustration">
        <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
          <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="2" stroke-dasharray="4 4"/>
          <path d="M32 18v16l10 10" stroke="#94a3b8" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <h3>Aucun tuteur compatible</h3>
      <p>Essayez d'élargir les critères de disponibilité ou de matière.</p>
    </div>

    <!-- Success Stats -->
    <div *ngIf="!loading && matches.length" class="status-bar">
      <div class="status-indicator">
        <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
          <path d="M11.6666 3.5L5.24992 9.91667L2.33325 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ matches.length }} tuteurs identifiés par l'algorithme
      </div>
    </div>

    <ng-container *ngIf="matches && matches.length">
      <div class="content-layout">
        
        <!-- SECTION MEILLEUR MATCH (HERO) -->
        <section class="best-match-section">
          <div class="section-label">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
              <path d="M7 1L8.5 4.5H12.5L9.5 7L10.5 11L7 8.5L3.5 11L4.5 7L1.5 4.5H5.5L7 1Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            </svg>
            Recommandation #1
          </div>

          <div class="card hero-card">
            <div class="card-glow"></div>
            <div class="card-header">
              <div class="tutor-info">
                <div class="avatar-circle hero-avatar">
                  {{ matches[0].tutor.full_name.charAt(0) }}
                </div>
                <div>
                  <h3>{{ matches[0].tutor.full_name }}</h3>
                  <span class="badge" 
                        [ngClass]="{
                          'badge-perfect': matches[0].match_type === 'perfect',
                          'badge-partial': matches[0].match_type === 'partial'
                        }">
                    {{ matches[0].match_type }} match
                  </span>
                </div>
              </div>
              <div class="score-ring-wrapper">
                <span class="big-score">{{ matches[0].score }}%</span>
                <span class="score-label">Compatibilité</span>
              </div>
            </div>

            <div class="hero-stats">
              <div class="stat-item">
                <span class="stat-label">Matières</span>
                <span class="stat-value">{{ subjectNames(matches[0]) }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Niveaux</span>
                <span class="stat-value">{{ levelNames(matches[0]) }}</span>
              </div>
            </div>
            
            <div class="availability-box" *ngIf="matches[0].availability_overlap">
               <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                 <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5"/>
                 <path d="M7 3.5V7L9.5 8.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
               </svg>
               Créneaux communs : <strong>{{ matches[0].availability_overlap }}</strong>
            </div>

            <button class="action-btn hero-btn">
              Sélectionner ce tuteur
            </button>
          </div>
        </section>

        <!-- LISTE DES AUTRES TUTEURS -->
        <section class="others-section">
          <div class="section-label">Autres profils pertinents</div>
          
          <div class="grid-cards">
            <div class="card standard-card" *ngFor="let m of matches.slice(1); let i = index" 
                 [style.animation-delay]="(i * 0.1) + 's'">
              
              <div class="card-header-compact">
                <div class="avatar-circle small">
                  {{ m.tutor.full_name.charAt(0) }}
                </div>
                <div class="header-text">
                  <h3>{{ m.tutor.full_name }}</h3>
                  <div class="mini-score">
                    Score : <strong>{{ m.score }}%</strong>
                  </div>
                </div>
              </div>

              <!-- Animated Progress Bar -->
              <div class="progress-container">
                <div class="progress-bar" [style.width]="m.score + '%'"></div>
              </div>

              <div class="tags-cloud">
                <span class="tag">{{ subjectNames(m) }}</span>
                <span class="tag">{{ levelNames(m) }}</span>
              </div>

              <div class="availability-row" *ngIf="m.availability_overlap">
                <span class="dot"></span>
                {{ m.availability_overlap }}
              </div>
            </div>
          </div>
        </section>

      </div>
    </ng-container>
  </main>
</div>
